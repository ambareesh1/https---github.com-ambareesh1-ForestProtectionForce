<p-panel [@fadeIn] header="{{editOrCreateText}}">

    <form  [formGroup]="userForm" (ngSubmit)="onSubmitUserDetails()">
        <div class="row">
            <div class="col-lg-6">
                <div class="field">
                    <label for="userType_Id" class="block">User Types <span class="required-field">*</span></label>
                    <p-dropdown  [options]="userTypes" [showClear]="true" class="offender-input-width" formControlName="userType_Id" optionLabel="name" optionValue="id"  (onChange)="onChangeUserType($event)"> </p-dropdown>
                   
                    <small class="p-error block"
                        *ngIf="userForm.get('userType_Id')?.invalid && userForm.get('userType_Id')?.dirty">
                        User Type Name is required.
                    </small>
                </div>
                <div class="field" [ngClass]="isProvinceRequired?'d-block':'d-none'">
                    <label for="userType_Name" class="block">Province<span class="required-field">*</span></label>
                    <p-dropdown  [options]="province" [showClear]="true" class="offender-input-width" formControlName="province" optionLabel="name" optionValue="id"  (onChange)="onProvinceChange($event)" [readonly]="isEditOrCaseEntryOperatorSelected"> </p-dropdown>
                   
                    <small class="p-error block"
                        *ngIf="userForm.get('province')?.invalid && userForm.get('province')?.dirty">
                        Provinceis required.
                    </small>
                </div>
                <div [ngClass]="isDistrictRequired?'d-block':'d-none'">
                <div class="field" >
                    <label for="userType_Name" class="block">Circle <span class="required-field">*</span></label>
                    <p-dropdown  [options]="circle" [showClear]="true" class="offender-input-width" formControlName="circle" optionLabel="name" optionValue="id"   (onChange)="onCircleChange($event)" [readonly]="isEditOrCaseEntryOperatorSelected">  </p-dropdown>
                   
                    <small class="p-error block"
                        *ngIf="userForm.get('circle')?.invalid && userForm.get('circle')?.dirty">
                        Circle is required.
                    </small>
                </div>
                <div class="field">
                    <label for="userType_Name" class="block">Forest Division / Gamma Unit<span class="required-field">*</span></label>
                    <p-dropdown  [options]="district" [showClear]="true" class="offender-input-width" formControlName="district" optionLabel="name" optionValue="id" [readonly]="isEditOrCaseEntryOperatorSelected" > </p-dropdown>
                   
                    <small class="p-error block"
                        *ngIf="userForm.get('district')?.invalid && userForm.get('district')?.dirty">
                        District is required.
                    </small>
                </div>
            </div>
                <!-- Username field -->
                <div class="field">
                    <label for="username" class="block">User name<span class="required-field">*</span></label>
                    <input id="username" pInputText type="text" class="offender-input-width"  [readOnly]="isEdit" [ngClass]="isEdit?'bg-grey':'bg-white'"
                        formControlName="username" />
                    <small class="p-error block"
                        *ngIf="userForm.get('username')?.invalid && userForm.get('username')?.dirty && !usernameControl?.hasError('usernameTaken')">
                        Username is required.
                    </small>
                    <small class="p-error block"
                    *ngIf="userForm.get('username')?.dirty && usernameControl?.hasError('usernameTaken')">
                    Username is already exists.
                </small>

                </div>

                <!-- First Name field -->
                <div class="field">
                    <label for="firstName" class="block">First Name<span class="required-field">*</span></label>
                    <input id="firstName" pInputText mode="text" class="offender-input-width"
                        formControlName="firstName" />
                    <small class="p-error block"
                        *ngIf="userForm.get('firstName')?.invalid && userForm.get('firstName')?.dirty">
                        First Name is required.
                    </small>
                </div>

                <div class="field">
                    <label for="lastName" class="block">Last Name<span class="required-field">*</span></label>
                    <input id="lastName" pInputText mode="text" class="offender-input-width"
                        formControlName="lastName" />
                    <small class="p-error block"
                        *ngIf="userForm.get('lastName')?.invalid && userForm.get('lastName')?.dirty">
                        Last Name is required.
                    </small>
                </div>
            </div>
            <div class="col-lg-6">

                <div class="field">
                    <label for="email" class="block">Email<span class="required-field">*</span></label>
                    <input id="email" pInputText mode="text" class="offender-input-width" formControlName="email"  [readOnly]="isEdit && !isEditOrCaseEntryOperatorSelected" [ngClass]="isEdit  && !isEditOrCaseEntryOperatorSelected ?'bg-grey':'bg-white'"  />
                    <small class="p-error block" *ngIf="userForm.get('email')?.invalid && userForm.get('email')?.dirty && !emailControl?.hasError('emailtaken')">
                        Email is required.
                    </small>
                    <small class="p-error block" *ngIf=" userForm.get('email')?.dirty && emailControl?.hasError('emailtaken')">
                    Email is already exists.
                </small>
                </div>

                <div class="field">
                    <label for="alternateEmail" class="block">Alternate Email</label>
                    <input id="alternateEmail" pInputText mode="text" class="offender-input-width"
                        formControlName="alternateEmail" />
                </div>

                <div class="field">
                    <label for="mobile" class="block">Mobile<span class="required-field">*</span></label>
                    <input id="mobile" pInputText mode="text" class="offender-input-width" formControlName="mobile" />
                    <small class="p-error block"
                        *ngIf="userForm.get('mobile')?.invalid && userForm.get('mobile')?.dirty && !phoneControl?.hasError('phoneTaken')">
                        Mobile is required.
                    </small>  <small class="p-error block"
                    *ngIf="phoneControl?.hasError('phoneTaken')">
                    Mobile No is already exists.
                </small>
                </div>

                <div class="field">
                    <label for="address" class="block">Address<span class="required-field">*</span></label>
                    <input id="address" pInputText mode="text" class="offender-input-width" formControlName="address" />
                    <small class="p-error block"
                        *ngIf="userForm.get('address')?.invalid && userForm.get('address')?.dirty">
                        <Address></Address> is required.

                    </small>
                </div>

            </div>
            <div class="p-card-footer flex justify-content-center flex-wrap gap-4">

                <button pButton type="submit" [class]="isEdit ? 'p-button-raised p-button-rounded p-button-warning':'p-button-raised p-button-rounded p-button-success'">{{isEdit?'Update':'Submit'}}</button>
                <button pButton type="reset" class="p-button-raised p-button-rounded p-button-secondary" (click)="onReset()">Cancel</button>
            </div>
        </div>
    </form>
<p-card header="Manage Users">

    <p-toolbar styleClass="p-mb-1">
       
        <ng-template pTemplate="right">
            <div class="p-d-flex p-ai-center p-jc-between">
                <span class="p-input-icon-left">
                    <i class="pi pi-search"></i>
                    <input pInputText type="text" [(ngModel)]="search" (input)="dt.filterGlobal(search, 'contains')"
                        placeholder="Search..." />

                </span>
            </div>
        </ng-template>
    </p-toolbar>
    <p-table #dt  [value]="userDetails" [rows]="10" dataKey="username"  [paginator]="true" [globalFilterFields]="['username']"
    [rowHover]="true" dataKey="id"  styleClass="p-datatable-gridlines"
    currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries" [showCurrentPageReport]="true"
        [tableStyle]="{ 'min-width': '50rem' }">
        <ng-template pTemplate="header">
            <tr>
                <th pSortableColumn="username">User Name<p-sortIcon field="username"></p-sortIcon></th>
                <th pSortableColumn="first_Name">First Name<p-sortIcon field="first_Name"></p-sortIcon></th>
                <th pSortableColumn="last_Name">Last Name<p-sortIcon field="last_Name"></p-sortIcon></th>
                <th pSortableColumn="userType_Name">User Type<p-sortIcon field="userType_Name"></p-sortIcon></th>
                <!-- <th pSortableColumn="district">District<p-sortIcon field="district"></p-sortIcon></th> -->
                <th pSortableColumn="email">Email<p-sortIcon field="email"></p-sortIcon></th>
                <th pSortableColumn="mobile">Phone No<p-sortIcon field="mobile"></p-sortIcon></th>
                <th></th>  
                <th></th>  
            </tr>
        </ng-template>

        <ng-template pTemplate="body" let-user>

            <tr *ngIf="user.username != this.usernameToCompare">
                <td>{{ user.username }}</td>
                <td>{{ user.first_Name }}</td>
                <td>{{ user.last_Name }}</td>
                <td>{{ user.userType_Name }}</td>
                <!-- <td>{{getDistrictName(user.districtId) }}</td> -->
                <td>{{ user.email }}</td>
                <td>{{ user.mobile }}</td>
                <td class="p-1">
                    <button pButton pRipple icon="pi pi-pencil" class="p-button-rounded p-button-secondary p-mr-2"
                        (click)="editUserDetails(user)"></button>
                </td>
                <td class="p-1">
                    <button pButton pRipple [icon]="user.isActive ? 'pi pi-lock' : 'pi pi-unlock'"
                        [class]="user.isActive ?'p-button-rounded p-button-secondary' : 'p-button-rounded p-button-danger'"
                        (click)="ActivateUserDetails(user)"></button>
                </td>
            </tr>
        </ng-template>
    </p-table>
</p-card>

</p-panel>
<p-toast></p-toast>
<p-confirmDialog [style]="{width: '750px'}"></p-confirmDialog>